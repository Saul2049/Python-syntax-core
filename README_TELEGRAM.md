# Telegram通知系统使用指南

本文档详细介绍了如何设置和使用交易系统的Telegram通知功能。

## 目录

1. [概述](#概述)
2. [设置步骤](#设置步骤)
3. [通知类型](#通知类型)
4. [命令与互动](#命令与互动)
5. [安全注意事项](#安全注意事项)
6. [故障排除](#故障排除)

## 概述

Telegram通知系统允许您接收以下内容的实时更新:
- 交易信号（买入/卖出）
- 止损更新
- 账户余额变动
- 系统状态提醒

这些通知可以帮助您随时了解交易系统的运行状况，无需持续监控交易终端。

## 设置步骤

### 1. 创建Telegram机器人

1. 在Telegram中搜索 `@BotFather`
2. 发送命令 `/newbot`
3. 为您的机器人提供名称（例如"我的交易助手"）
4. 为机器人提供用户名（必须以"bot"结尾，例如"MyTradingAssistant_bot"）
5. BotFather将提供一个API令牌，如下所示:
   ```
   123456789:ABCdefGhIJKlmNoPQRsTUVwxyZ
   ```
6. **重要**: 安全保存此令牌，不要与他人分享

### 2. 获取聊天ID

要获取您的聊天ID，有两种方法:

**方法一 (推荐)**
1. 向您的新机器人发送消息（任何文本均可）
2. 在浏览器中访问:
   ```
   https://api.telegram.org/bot<您的API令牌>/getUpdates
   ```
3. 在响应中找到 `"chat":{"id":XXXXXXXXX` - 这个数字就是您的聊天ID

**方法二**
1. 在Telegram中搜索 `@userinfobot`
2. 发送任何消息给这个机器人
3. 机器人将回复您的ID

### 3. 配置系统

#### 使用命令行工具

使用我们的配置工具设置Telegram凭证:
```bash
python load_env.py --tg_token=YOUR_TOKEN --tg_chat=YOUR_CHAT_ID --save
```

#### 手动编辑.env文件

或直接编辑项目根目录下的.env文件:
```
TG_TOKEN=your_telegram_bot_token
TG_CHAT=your_chat_id
```

#### 通过环境变量

如果您不想保存凭证到文件中:
```bash
export TG_TOKEN=your_telegram_bot_token
export TG_CHAT=your_chat_id
```

### 4. 测试配置

设置完成后，运行测试脚本以验证配置是否正确:
```bash
python test_telegram.py
```

如果配置正确，您应该在Telegram中收到测试消息。

## 通知类型

系统会发送以下类型的通知:

### 买入信号
通知您系统执行买入操作，包含价格、数量和初始止损价。
```
🟢 买入信号
0.123 BTC @ 50123.45 USDT
止损价: 49500.00 USDT
账户余额: 12345.67 USDT
```

### 止损更新
通知您系统调整止损价格以锁定利润或降低风险。
```
🔶 止损更新
0.123 BTC 持仓
新止损价: 49800.00 USDT
账户余额: 12345.67 USDT
```

### 卖出信号
通知您系统执行卖出操作，无论是止损触发还是获利平仓。
```
🔴 卖出信号
0.123 BTC @ 51234.56 USDT
账户余额: 12678.90 USDT
```

### 系统状态
通知您系统启动、停止或遇到错误。
```
ℹ️ 系统信息
交易系统已启动
监控中: BTC/USDT
```

## 命令与互动

目前的实现仅提供单向通知。未来版本将支持通过Telegram向系统发送以下命令:

- `/status` - 获取系统状态和当前持仓
- `/balance` - 查询账户余额
- `/stop` - 停止交易系统
- `/start` - 启动交易系统

## 安全注意事项

为确保您的交易系统和账户安全:

1. **永远不要分享您的Telegram机器人令牌** - 它可以被用来冒充您的机器人
2. **限制机器人功能** - 考虑创建一个仅用于通知的机器人，不赋予其控制交易系统的权限
3. **使用私人聊天** - 不要将您的交易机器人添加到群聊中
4. **定期更新令牌** - 考虑定期重新生成Telegram机器人令牌
5. **监控活动** - 定期检查机器人的活动，确保没有未授权的访问

## 故障排除

如果您遇到通知问题:

1. **检查网络连接** - 确保您的服务器可以访问Telegram API
2. **验证凭证** - 再次检查令牌和聊天ID是否正确
3. **查看日志** - 检查系统日志以获取更详细的错误信息
4. **重新生成令牌** - 如果问题持续，尝试使用BotFather重新生成令牌

```
python test_telegram.py --debug
```

使用`--debug`标志可以显示详细的API响应和错误信息，帮助诊断问题。 